{%- if page.comments != false -%}
<div class="comments">
  <h2 class="comments-title">Comments</h2>

  <!-- Display existing comments -->
  {% assign comments = site.data.comments[page.slug] %}
  {% if comments.size > 0 %}
    {% assign comments_sorted = comments | sort %}
    {% for comment in comments_sorted %}
      {% assign commentData = comment[1] %}
      <div class="comment">
        <div class="comment-header">
          <span class="comment-author">{{ commentData.name }}</span>
          <span class="comment-date">
            {% assign date = commentData.date | date: "%s" | plus: 0 %}
            {{ date | date: "%B %d, %Y" }}
          </span>
        </div>
        <div class="comment-content">
          {{ commentData.message | markdownify }}
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p class="no-comments">No comments yet. Be the first to comment!</p>
  {% endif %}

  <!-- New comment form -->
  <form class="comment-form" method="POST" action="https://api.staticman.net/v3/entry/github/{{ site.github_username }}/{{ site.github_username }}.github.io/{{ site.branch }}/comments">
    <!-- The fields from staticman.yml allowedFields -->
    <input name="options[redirect]" type="hidden" value="{{ site.url }}{{ page.url }}">
    <input name="options[slug]" type="hidden" value="{{ page.slug }}">
    
    <div class="form-group">
      <label for="comment-form-name">Name*</label>
      <input id="comment-form-name" name="fields[name]" type="text" required spellcheck="false">
    </div>

    <div class="form-group">
      <label for="comment-form-email">Email (optional, will not be displayed)</label>
      <input id="comment-form-email" name="fields[email]" type="email" spellcheck="false">
    </div>

    <div class="form-group">
      <label for="comment-form-url">Website (optional)</label>
      <input id="comment-form-url" name="fields[url]" type="url" spellcheck="false">
    </div>

    <div class="form-group">
      <label for="comment-form-message">Comment*</label>
      <textarea id="comment-form-message" name="fields[message]" required spellcheck="true" rows="6"></textarea>
    </div>

    <div class="form-group">
      <button type="submit">Submit Comment</button>
    </div>

    <p class="comment-notice">
      Comments will be reviewed before appearing on the site. 
      Markdown formatting is supported.
    </p>
  </form>
</div>
{%- endif -%} 